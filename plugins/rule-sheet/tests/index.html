<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>stylis rule sheet</title>
	<script src='../../../stylis.js'></script>
	<script src='../index.js'></script>
</head>
<body>

	<h1>Hello</h1>

<script>
var sample = `
	@import "./index.html";

	body {
		background: gray;
	}

	h1 {
		color: papayawhip;
	}

	h2 {
		color: red;

		div, h3 {
			width: 10px;
			color: red;
		}
	}

	div {
		font:none;
	}

	@keyframes hahaha {
	  from {top: 0;}
	  to {top: 100;}
	}

	@font-face {
		src: none;
	}

	@page {size:A4 landscape;}

	font-size: 2rem;
	padding: 16px;

	&:hover {
	  color: pink;
	  &.class {
	    color: purple;
	  }
	  &.some-class {
	    color: hotpink;
	  }
	}

	@media {
		content: "?";
	}

	&.other-class {
	  color: blue;
	  &:active {
	    color: red;
	  }
	}

	h1 {
		width: auto;

		div {
			height: 0;

			@media {
				color: blue;

				h2 {
					color: purple;
				}
			}
		}
	}

	textarea::placeholder,
	input::placeholder {
		color:red;
	}

	@supports(position: sticky){
    background: red;
  }

  @media (max-width: 64em) {
    .test {
      margin-bottom: 1em;
    }
    @supports (-moz-appearance: none) and (display: contents) {
      .test {
        margin-bottom: 2rem;
      }
    }
  }

span { color: red }
@import url('something');
@font-face { font-family: test; src: url(test.woff); }
div { color: red }
`

var sample = `
@media (width: 0) {
  .test {
    margin-bottom: 1;
  }
  @supports (font: none) {
    .test {
      margin-top: 2;
    }
  }
}
`

var sheet = document.head.appendChild(document.createElement('style')).sheet
var length = sheet.cssRules.length
var result = []
var skipped = []
var plugin = stylisRuleSheet((value) => {
	length = sheet.insertRule(value, length) + 1
	result.push(value)
})

stylis.use(plugin)

stylis('html', `@media all { ${sample} }`)

result = result.join('')
var expected = `@font-face{src:none;}@page{size:A4 landscape;}@font-face{font-family:test;src:url(test.woff);}@media all{@import "./index.html";@import url('something');html{font-size:2rem;padding:16px;}html body{background:gray;}html h1{color:papayawhip;}html h2{color:red;}html h2 div,html h2 h3{width:10px;color:red;}html div{font:none;}@-webkit-keyframes hahahahtml{from{top:0;}to{top:100;}}@keyframes hahahahtml{from{top:0;}to{top:100;}}@media (max-width:64em){html .test{margin-bottom:1em;}@supports (-moz-appearance:none) and (display:contents){html .test{margin-bottom:2rem;}}}}`
console.assert(result === expected, `

Expected:

	${expected}

Instead got:

 	${result}
`)

if (result !== expected) {
	alert('Compilation failed, look at the console for more details')
}
</script>

</body>
</html>
